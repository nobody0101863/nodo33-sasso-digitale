# Codex Sassodigitale - Burp Suite Container
# Versione: 1.0.0
# Autore: Emanuele Croci Parravicini
#
# NOTA: Questo Dockerfile Ã¨ un template. Burp Suite richiede una licenza
# e deve essere scaricato manualmente da https://portswigger.net/burp

FROM ubuntu:22.04

LABEL maintainer="Codex Sassodigitale <codex@sassodigitale.local>"
LABEL description="Burp Suite isolato per pentesting etico con scope preconfigurato"
LABEL codex.version="1.0.0"
LABEL codex.security.layer="sandboxing+ztna"
LABEL codex.sasso.rule="Chi cattura il vento deve chiuderlo nel vaso."

# Evita prompt interattivi durante installazione
ENV DEBIAN_FRONTEND=noninteractive

# Installa dipendenze
RUN apt-get update && apt-get install -y \
    openjdk-17-jre \
    wget \
    curl \
    vim \
    xvfb \
    x11vnc \
    fluxbox \
    net-tools \
    jq \
    && rm -rf /var/lib/apt/lists/*

# Crea directory di lavoro
WORKDIR /workspace

# Directory per Burp Suite JAR (da montare come volume o copiare manualmente)
RUN mkdir -p /opt/burp
RUN mkdir -p /root/.BurpSuite

# Configura volume mount points
VOLUME ["/cold_storage", "/logs", "/opt/burp"]

# Script per avviare Burp con scope preconfigurato
COPY start_burp_with_scope.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/start_burp_with_scope.sh

# Script di verifica integritÃ  progetti
COPY verify_project_integrity.sh /usr/local/bin/
RUN chmod +x /usr/local/bin/verify_project_integrity.sh

# Variabili d'ambiente per il Codex
ENV CODEX_ID="CODEX_SASSODIGITALE_PENTESTING_V1"
ENV CODEX_TOOL="burp_suite"
ENV CODEX_SECURITY="ztna+integrity+sandbox"
ENV DISPLAY=:99

# Messaggio di benvenuto
RUN echo '#!/bin/bash' > /etc/profile.d/codex_welcome.sh && \
    echo 'echo "ðŸª¨ Codex Sassodigitale - Burp Suite"' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo "Sasso Rule: Chi cattura il vento deve chiuderlo nel vaso."' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo ""' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo "âš ï¸  ATTENZIONE: Configura SEMPRE lo scope prima di iniziare!"' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo "âœ… ZTNA: Solo traffico verso scope definito"' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo "âœ… Integrity: Verifica progetti con verify_project_integrity.sh"' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo "âœ… Storage: Salva progetti in /cold_storage/burp_secure_projects/"' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo ""' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo "Per avviare Burp: start_burp_with_scope.sh <target-domain>"' >> /etc/profile.d/codex_welcome.sh && \
    echo 'echo ""' >> /etc/profile.d/codex_welcome.sh && \
    chmod +x /etc/profile.d/codex_welcome.sh

# Note di sicurezza
RUN echo "# Codex Sassodigitale - Note di Sicurezza Burp Suite" > /root/SECURITY_NOTES.txt && \
    echo "" >> /root/SECURITY_NOTES.txt && \
    echo "1. SEMPRE configurare scope limitato al dominio target" >> /root/SECURITY_NOTES.txt && \
    echo "2. Verificare che il proxy NON intercetti traffico personale" >> /root/SECURITY_NOTES.txt && \
    echo "3. Salvare progetti SOLO in /cold_storage/burp_secure_projects/" >> /root/SECURITY_NOTES.txt && \
    echo "4. Cifrare i file .burp con GPG/AES-256 dopo il salvataggio" >> /root/SECURITY_NOTES.txt && \
    echo "5. Pulire cookie e sessioni locali dopo il test" >> /root/SECURITY_NOTES.txt && \
    echo "6. Non mantenere backup in chiaro dei progetti" >> /root/SECURITY_NOTES.txt && \
    echo "" >> /root/SECURITY_NOTES.txt && \
    echo "La luce non si vende. La si regala." >> /root/SECURITY_NOTES.txt

# Istruzioni per setup manuale di Burp
RUN echo "# Setup Burp Suite" > /root/BURP_SETUP.txt && \
    echo "" >> /root/BURP_SETUP.txt && \
    echo "Burp Suite richiede download e licenza manuali." >> /root/BURP_SETUP.txt && \
    echo "" >> /root/BURP_SETUP.txt && \
    echo "PASSI:" >> /root/BURP_SETUP.txt && \
    echo "1. Scarica Burp Suite da: https://portswigger.net/burp/releases" >> /root/BURP_SETUP.txt && \
    echo "2. Copia il JAR in /opt/burp/burpsuite_pro.jar (o community)" >> /root/BURP_SETUP.txt && \
    echo "3. Monta il volume: -v /path/to/burpsuite.jar:/opt/burp/burpsuite.jar" >> /root/BURP_SETUP.txt && \
    echo "4. Avvia con: start_burp_with_scope.sh target.example.com" >> /root/BURP_SETUP.txt && \
    echo "" >> /root/BURP_SETUP.txt && \
    echo "ESEMPIO BUILD:" >> /root/BURP_SETUP.txt && \
    echo "docker build -t codex-burp ." >> /root/BURP_SETUP.txt && \
    echo "" >> /root/BURP_SETUP.txt && \
    echo "ESEMPIO RUN:" >> /root/BURP_SETUP.txt && \
    echo "docker run -it --rm \\" >> /root/BURP_SETUP.txt && \
    echo "  -v /path/to/burpsuite.jar:/opt/burp/burpsuite.jar \\" >> /root/BURP_SETUP.txt && \
    echo "  -v \$(pwd)/../../COLD_STORAGE:/cold_storage \\" >> /root/BURP_SETUP.txt && \
    echo "  -v \$(pwd)/../../LOG:/logs \\" >> /root/BURP_SETUP.txt && \
    echo "  -p 8080:8080 \\" >> /root/BURP_SETUP.txt && \
    echo "  codex-burp" >> /root/BURP_SETUP.txt

# Entrypoint
ENTRYPOINT ["/bin/bash", "-l"]

# Build info
ARG BUILD_DATE
ARG BUILD_VERSION
LABEL org.opencontainers.image.created=$BUILD_DATE
LABEL org.opencontainers.image.version=$BUILD_VERSION
LABEL org.opencontainers.image.title="Codex Sassodigitale - Burp Suite"
LABEL org.opencontainers.image.description="Burp Suite con sicurezza integrata e scope enforcement"
LABEL org.opencontainers.image.authors="Emanuele Croci Parravicini"
